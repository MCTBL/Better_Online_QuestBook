(()=>{"use strict";var t,e,s;!function(t){t.selectBtnIndex="selectBtnIndex",t.language="language"}(t||(t={})),function(t){t.zh="zh",t.en="en"}(e||(e={}));class i{static showTips(t){const e=(t.match(/[\u4e00-\u9fa5]/g)||[]).length,s=30*e+15*(t.length-e)+40;$("#tips").text(t),$("#tips").css("width",s+"px"),$("#tips").css("display","flex"),$("#tips").css("bottom","-70px"),$("#tips").animate({bottom:"0px"},500),this.tipsTimer&&(clearTimeout(this.tipsTimer),this.tipsTimer=0),this.tipsTimer=setTimeout((()=>{$("#tips").animate({bottom:"-70px"},500),$("#tips").css("display","none")}),2e3)}static showLoading(){$("#loadingMask").show()}static hideLoading(){$("#loadingMask").hide()}}i.tipsTimer=0;class a{static processUrlParameters(t){let e=new Map;for(var s of t.searchParams.keys())e.set(s,t.searchParams.get(s));return e}static typeText(t,e,s=50){const i=$(t);i.text("");let a=0;null!==this.typingInterval&&clearInterval(this.typingInterval),this.typingInterval=setInterval((()=>{a<e.length?(i.append(e.charAt(a)),a++):(isNaN(Number(this.typingInterval))||clearInterval(Number(this.typingInterval)),this.typingInterval=null)}),s)}static copyH5Str(t){var e=t+"";const s=document.createElement("textarea");s.value=e,s.setAttribute("readonly",""),s.style.position="absolute",s.style.left="-9999px",s.style.fontSize="12pt";const i=getSelection();var a;i.rangeCount>0&&(a=i.getRangeAt(0)),document.body.appendChild(s),s.select(),s.selectionStart=0,s.selectionEnd=e.length;try{document.execCommand("copy")}catch(t){}document.body.removeChild(s),a&&(i.removeAllRanges(),i.addRange(a))}static encodeMsg2AHref(t){return t.replace(/\[url\](https?:\/\/[^\s\[\]]+)\[\/url\]/g,'<a href="$1" target="_blank">$1</a>')}static expMCcolor(t){if(!t.includes("§"))return t;var e=/([^§]+)/g;if(null==t.match(e))return console.error("正则匹配失败"),t;for(var s=document.createElement("span"),i=t.match(e).length,a="#000000",o="normal",n="none",l="normal",r=0;r<i;r++){var c=t.match(e)[r],h=c.substring(0,1),u=document.createElement("quest_desc"),g=this.functioncolor(h);"#"==g.substring(0,1)?(a=g,n="none",l="normal",o="normal"):"bold"==g?o=g:"line-through"==g||"underline"==g?(n=g,o="normal"):"italic"==g?l=g:"none"==g&&(a="#000000",o="normal",n="none",l="normal");var p=c.substr("unknown style"==g?0:1);0!=p.length&&(u.style.color=a,u.style.fontWeight=o,u.style.textDecoration=n,u.style.fontStyle=l,u.innerHTML=p,s.append(u))}return s.innerHTML}static functioncolor(t){return"a"==t?"#55ff55":"b"==t?"#4de6e6":"c"==t?"#ff5555":"d"==t?"#ff55ff":"e"==t?"#bebe00":"f"==t?"#ffffff":"g"==t?"#ddd605":"0"==t?"#000000":"1"==t?"#0000aa":"2"==t?"#00aa00":"3"==t?"#00aaaa":"4"==t?"#aa0000":"5"==t?"#aa00aa":"6"==t?"#ffaa00":"7"==t?"#aaaaaa":"8"==t?"#555555":"9"==t?"#5555ff":"k"==t?"Random":"l"==t?"bold":"m"==t?"line-through":"n"==t?"underline":"o"==t?"italic":"r"==t?"none":"unknown style"}static deepClone(t){const e=new o;function s(t){return"object"==typeof t&&t||"function"==typeof t}return function t(i){if(!s(i))return i;if(-1!==[Date,RegExp].indexOf(i.constructor))return new i.constructor(i);if("function"==typeof i)return"not support";const a=e.get(i);if(a)return a;if(Array.isArray(i)){let e=[];for(let s=0;s<i.length;s++)e.push(t(i[s]));return e}if(i instanceof Map){const a=new Map;return e.set(i,a),i.forEach(((e,i)=>{s(e)?a.set(i,t(e)):a.set(i,e)})),a}if(i instanceof Set){const a=new Set;return e.set(i,a),i.forEach((e=>{s(e)?a.add(t(e)):a.add(e)})),a}const o=Reflect.ownKeys(i);var n={};Object.keys(i).forEach((function(t){n[t]=Object.getOwnPropertyDescriptor(i,t)}));const l=Object.create(Object.getPrototypeOf(i),n);return e.set(i,l),o.forEach((e=>{const a=i[e];s(a)?l[e]=t(a):l[e]=a})),l}(t)}static removeHTMLTags(t){let e=t.replace(/<br\s*\/?>/gi,"\n");return e=e.replace(/<a\s+[^>]*?href=["']([^"']*)["'][^>]*?>([^<]*?)<\/a>/gi,((t,e,s)=>`${e}`)),e=e.replace(/<[^>]*>/g,""),e}static shuffle(t){for(let e=t.length-1;e>0;e--){const s=Math.floor(Math.random()*(e+1));[t[e],t[s]]=[t[s],t[e]]}return t}}a.typingInterval=null;class o{constructor(){this._keys=[],this._values=[]}set(t,e){const s=this._keys.indexOf(t);-1===s?(this._keys.push(t),this._values.push(e)):this._values[s]=e}get(t){const e=this._keys.indexOf(t);return-1===e?void 0:this._values[e]}has(t){return-1!==this._keys.indexOf(t)}delete(t){const e=this._keys.indexOf(t);return-1!==e&&(this._keys.splice(e,1),this._values.splice(e,1),!0)}}class n{static showEegg(){Math.random()<this.rate&&(-1==this.txtIndex&&(a.shuffle(this.eeggs.txt),this.txtIndex=0),-1==this.imgIndex&&(a.shuffle(this.eeggs.img),this.imgIndex=0),Math.random()<.5?(i.showTips(this.eeggs.txt[this.txtIndex]),this.txtIndex++,this.txtIndex>=this.eeggs.txt.length&&(this.txtIndex=0)):(console.log(this.eeggs.img[this.imgIndex]),this.imgIndex++,this.imgIndex>=this.eeggs.img.length&&(this.imgIndex=0)))}}n.txtIndex=-1,n.imgIndex=-1,n.eeggs={txt:["GTNH is like a job"],img:["static/eeggs/1.png"]},n.rate=.1;class l{}l.projectName="BetterOnlineQuestBook",l.projectName_zh="更好的在线任务书",l.projectNm="BOQB",l.projectDsc_zh="一时间想不起是哪个任务但又不方便开游戏?试试这个,更好的在线任务书!",l.projectDsc="A convenient online quest book when you can't remember which quest to play!",l.projectVersion="1.0.0",l.projectDescription="BetterOnlineQuestBook",l.projectAuthor=["MCTBL","Grievous_Rain"],l.versionList=["2.7.2"],l.resList=["272","270"],l.questLinePath="quest_line.json",l.questDataPath="quest_json",l.projectUrl="https://github.com/MCTBL/Better_Online_QuestBook",window.ProjectConfig=l;class r{static getPath(t){return"version/"+l.resList[r.selectVersionIndex]+"/"+t}static getQuestLinePath(){return this.getPath(l.questLinePath)}static getQuestDataPath(t){var s=this.getPath(l.questDataPath);return t==e.en&&(s+="_en"),s+".json"}}r.language=e.zh,r.isPhone=!1,r.selectVersionIndex=0,r.fakeQuest={name:5,symbolSize:29,symbol:"image://static/not_main.png",x:252,y:180,select:{disabled:!0},tooltip:{show:!1}},r.echartsConfig={backgroundColor:"#f5f0d3",animation:!0,animationThreshold:2e3,animationDuration:1e3,animationEasing:"cubicOut",animationDelay:0,animationDurationUpdate:300,animationEasingUpdate:"cubicOut",animationDelayUpdate:0,aria:{enabled:!1},color:["#5470c6","#91cc75","#fac858","#ee6666","#73c0de","#3ba272","#fc8452","#9a60b4","#ea7ccc"],series:[{type:"graph",layout:"none",symbolSize:10,circular:{rotateLabel:!1},force:{repulsion:0,gravity:0,edgeLength:30,friction:.6,layoutAnimation:!0},label:{show:!1,position:"up",margin:8,valueAnimation:!1},lineStyle:{show:!0,width:1,opacity:1,curveness:0,type:"solid"},roam:!0,draggable:!1,focusNodeAdjacency:!0,data:null,edgeLabel:{show:!1,margin:8,valueAnimation:!1},edgeSymbol:["circle","arrow"],edgeSymbolSize:10,links:null,emphasis:{disabled:!0,scale:1,focus:"None"}}],legend:[{data:[],selected:{}}],tooltip:{trigger:"item",triggerOn:"mousemove|click",axisPointer:{type:"line"},showContent:!0,alwaysShowContent:!1,showDelay:0,hideDelay:100,enterable:!1,confine:!1,appendToBody:!1,transitionDuration:.4,textStyle:{fontSize:14},borderWidth:0,padding:5,order:"seriesAsc"}},r.infoQuest=[{title:`§9§l${l.projectName}§r`,name:"",symbolSize:0,symbol:"logo.png",x:0,y:0,data:`§c§l${l.projectDsc}§r<br/><br/>§lAuthor:§r §9§l<a class="githubLink" href="https://github.com/MCTBL" target="_blank">${l.projectAuthor[0]}</a>§r、 §3§l<a class="githubLink" href="https://github.com/NoRainLand" target="_blank">${l.projectAuthor[1]}</a>§r<br/><br/>§lProject Address: [url]${l.projectUrl}[/url]§r<br/>- If you have any questions or needs, please go to the repository to submit an issue.<br/><br/>The icon in the upper right corner can switch languages, the lower left corner can turn the taskbar on and off, and the upper left corner is the search bar.<br/><br/>The §lscroll wheel§r can zoom in and out of the chart, and the §lleft mouse button§r can also drag.<br/><br/>§lShortcut keys:§r<br/>§lR§r - Reset the chart<br/>§lESC / E§r - Exit task details, or simply click on the black area outside the task box.<br/>`,quest_id:"",tooltip:"",is_main:0},{title:`§9§l${l.projectName_zh}§r`,name:"",symbolSize:0,symbol:"logo.png",x:0,y:0,data:`<br/>§c§l${l.projectDsc_zh}§r<br/><br/>§l作者:§r §9§l<a class="githubLink" href="https://github.com/MCTBL" target="_blank">${l.projectAuthor[0]}</a>§r、 §3§l<a class="githubLink" href="https://github.com/NoRainLand" target="_blank">${l.projectAuthor[1]}</a>§r<br/><br/>§l项目地址: [url]${l.projectUrl}[/url]§r<br/>- 有任何问题或需求前往仓库提交issue即可<br/><br/><br/><br/>§l滚轮§r可对图表进行缩放，§l左键§r可拖动<br/><br/>§l快捷键：§r<br/>§lR§r - 重置图表<br/>§lESC / E§r - 退出任务详情，或直接点击任务框外侧黑色区域即可<br/><br/>`,quest_id:"",tooltip:"",is_main:0}];class c{static showPopup(t){this.nowTitle=a.expMCcolor(t.title),this.nowDesc=this.processDesc(a.expMCcolor(t.data)),this.nowID=t.quest_id,this.nowLogo=t.symbol.replace("image://",""),$("#quest_id").text(this.nowID),$("#popTitle").html(this.nowTitle),$("#popDesc").html(this.nowDesc),$("#quest_logo")[0].setAttribute("src",this.nowLogo),$("#mainPage").focus(),removeEventListener("keydown",this.onKeyDown),addEventListener("keydown",this.onKeyDown),$("#overlay").off("click"),$("#overlay").on("click",this.hidePopup),$("#popup").off("click"),$("#popup").on("click",this.onClickPop),$("#copyBtn").off("click"),$("#copyBtn").on("click",this.onCopyDesc),$("#copyBtn").css("display","block"),$("#copyIdBtn").off("click"),$("#copyIdBtn").on("click",this.onCopyId),$("#copyIdBtn").css("display","block"),$("#copyLinkBtn").off("click"),$("#copyLinkBtn").on("click",this.onCopyLink),$("#copyLinkBtn").css("display","block"),$("#copyBtn").text(r.language==e.zh?"复制任务详情":"Copy Desc"),$("#copyIdBtn").text(r.language==e.zh?"复制任务ID":"Copy ID"),$("#copyLinkBtn").text(r.language==e.zh?"复制任务链接":"Copy Link"),$("btnClosePop").off("click"),$("#btnClosePop").on("click",this.hidePopup),$("#screenShot").off("click"),$("#screenShot").on("click",this.screenShot),$("#popup").css("scale",.8),$("#overlay").css("display","flex"),$("#popup").animate({scale:1},200)}static showInfoPopup(){this.showPopup(r.language.includes("zh")?r.infoQuest[1]:r.infoQuest[0]),$("#copyBtn").css("display","none"),$("#copyIdBtn").css("display","none"),$("#copyLinkBtn").css("display","none")}static processDesc(t){let e=t.split(/\[\/?url\]/),s="";for(let t=0;t<e.length;t++)if(void 0!==e[t])if(t%2==1&&e[t].trim().length>0){let i=e[t];s+=`<a href="${i}" target="_blank">${i}</a>`}else s+=e[t];e=s.split(/\[\/?note\]/),s="";for(let t=0;t<e.length;t++)void 0!==e[t]&&(t%2==1&&e[t].trim().length>0?s+=`<note style='color:#00AAAA'>${e[t]}</note>`:s+=e[t]);e=s.split(/\[\/?warn\]/),s="";for(let t=0;t<e.length;t++)void 0!==e[t]&&(t%2==1&&e[t].trim().length>0?s+=`<warn style='color:#AA0000'>${e[t]}</warn>`:s+=e[t]);return s}static screenShot(){}}s=c,c.nowTitle="",c.nowDesc="",c.nowID="",c.nowLogo="",c.onCopyDesc=()=>{a.copyH5Str(a.removeHTMLTags(`${s.nowTitle}\n${s.nowDesc}`)),i.showTips(r.language==e.zh?"复制成功":"Copy Success")},c.onCopyId=()=>{a.copyH5Str(s.nowID),i.showTips(r.language==e.zh?"复制成功":"Copy Success")},c.onCopyLink=()=>{a.copyH5Str(r.basicUrl+"?id="+s.nowID),i.showTips(r.language==e.zh?"复制成功":"Copy Success")},c.hidePopup=()=>{$("#overlay").css("display","none")},c.onClickPop=t=>{t.stopPropagation()},c.onKeyDown=t=>{"Escape"!=t.key&&"e"!=t.key||s.hidePopup()};class h{static resetChart(){var t,e,s;null===(t=this.echarts)||void 0===t||t.clear(),null===(e=this.echarts)||void 0===e||e.resize(),null===(s=this.echarts)||void 0===s||s.setOption(this.pageData)}static getPageData(t){r.isPhone?this.showSearchPopup(t.data.data):(a.typeText("#questTitle",t.title),this.pageData=a.deepClone(r.echartsConfig),this.pageData.series[0].data=t.data.data,this.pageData.series[0].links=t.data.links,this.initEcharts())}static initEcharts(){if(!this.echarts){this.echarts=echarts.init(document.getElementById("this_chart"),"white",{renderer:"canvas"}),this.echarts.on("click",(t=>{"node"===t.dataType&&t.data.hasOwnProperty("quest_id")&&c.showPopup(t.data)}));const t=$("#mainPage")[0];new ResizeObserver((()=>{this.onResize()})).observe(t)}this.resetChart()}static onResize(){var t;null===(t=this.echarts)||void 0===t||t.resize()}static showSearchPopup(t){$("#questSearchList").empty(),t&&t.length&&(this.questList=t,this.showSearchList(),$("#searchPopup").show())}static clearSearchList(){$("#questSearchList").empty(),$("#searchPopup").hide()}static toTop(){$("#questSearchList").animate({scrollTop:0},500)}static showSearchList(){this.questList&&this.questList.length&&this.questList.forEach((t=>{if(t&&void 0!==t.title){const e=$(`\n\t\t\t\t\t\t<div class="searchItem" data-id="${t.quest_id}">\n\t\t\t\t\t\t\t<img class="searchImg" src="${t.symbol.replace("image://","")}" />\n\t\t\t\t\t\t\t<div class="searchTitle">${a.expMCcolor(t.title)}</div>\n\t\t\t\t\t\t\t<div class="searchDesc">${a.expMCcolor(t.data.substring(0,50))}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`);e.off("click"),e.on("click",(()=>{c.showPopup(t)})),$("#questSearchList").append(e)}}))}}class u{constructor(){this.questLine=[],this.buttonList=[],this.isSidebarHide=!1,this.questAllData={},this.titleToQuest={},this.questIdToQuest={},this.oldQuestData=null,this.startX=0,this.startY=0,this.onKeyDown=t=>{"r"==t.key&&h.resetChart()},this.onClickLogo=()=>{n.showEegg()},this.onRightClickLogo=t=>{t.preventDefault(),t.stopPropagation()},this.toggleSidebar=()=>{let t=$("#sidebar").width();$("#toggleSidebar").hide();let e=r.isPhone?250:500;if(setTimeout((()=>{$("#toggleSidebar").show()}),e),this.isSidebarHide){if($("#sidebar").animate({left:"0px"},e),!r.isPhone){let s=$(window).width()-t;$("#mainPage").animate({left:`${t}px`,width:s+"px"},e)}this.isSidebarHide=!1}else $("#sidebar").animate({left:`-${t}px`},e),r.isPhone||$("#mainPage").animate({left:"0px",width:"100%"},e),this.isSidebarHide=!0},this.onSearchFocus=()=>{},this.onSeachInput=()=>{let t=$("#search").val();if(t){"none"==$("#btnCloseSp").css("display")&&($("#btnCloseSp").show(),$("#btnCloseSp").animate({opacity:1},500)),r.isPhone&&$("#logoBg").animate({opacity:.4},500);let e=[];for(let s in this.titleToQuest[r.language])if(-1!=s.toLocaleUpperCase().indexOf(t.toString().toLocaleUpperCase())){let t=this.titleToQuest[r.language][s];null!=t.title&&e.push(t)}h.showSearchPopup(e)}else this.onClosePop()},this.onClosePop=()=>{$("#search").val(""),$("#btnCloseSp").hide(),$("#btnCloseSp").css("opacity",0),r.isPhone&&$("#logoBg").css("opacity",1),r.isPhone?h.getPageData(this.oldQuestData):h.clearSearchList()},this.onSearchBlur=()=>{},this.onChangeLang=()=>{i.showLoading(),r.language==e.zh?r.language=e.en:r.language=e.zh,localStorage.setItem(t.language,r.language),this.initTitle(),r.isPhone||this.onClosePop(),this.loadQuestData()},this.onClickTop=()=>{this.isSidebarHide?h.toTop():$("#sidebar").animate({scrollTop:0},500)},this.whenRightSlide=t=>{const e=t.changedTouches[0].clientX-this.startX,s=t.changedTouches[0].clientY-this.startY;Math.abs(s)<=10&&e>50&&this.isSidebarHide&&r.isPhone&&this.toggleSidebar()},$((()=>{i.showLoading();let t=new URL(window.location.href);r.urlParameter=a.processUrlParameters(t),r.basicUrl=t.origin,this.initPlatform(),this.initLang(),this.initPage(),this.addEvent(),this.loadQuestLine(),this.showProjectMsg()}))}initPlatform(){isMobile.phone?r.isPhone=!0:r.isPhone=!1}showProjectMsg(){setTimeout((()=>{console.log(`%c${l.projectName_zh}\n\n%c${l.projectDsc_zh}\n\n%c作者: ${l.projectAuthor}\n\n%c项目地址: ${l.projectUrl}`,"color:#252525; font-size: 30px;","color:#e12885; font-size: 18px;","color:#137a7f; font-size: 20px;","color:#525658; font-size: 16px;")}),300)}initPage(){for(let t=0;t<l.versionList.length;t++){let e=$("<option>",{text:l.versionList[t],value:l.versionList[t]});$("#versionSelect").append(e)}}initLang(){localStorage.getItem(t.language)?localStorage.getItem(t.language)==e.zh?r.language=e.zh:r.language=e.en:navigator.language.includes("zh")?r.language=e.zh:r.language=e.en,this.initTitle()}initTitle(){r.language==e.zh?document.title=l.projectName_zh:document.title=l.projectName}addEvent(){$("#toggleSidebar").on("click",this.toggleSidebar),addEventListener("keydown",this.onKeyDown),addEventListener("touchstart",(t=>{this.startX=t.touches[0].pageX,this.startY=t.touches[0].pageY})),addEventListener("touchend",this.whenRightSlide),$("#logoImg").on("click",this.onClickLogo),$("#logoImg").on("contextmenu",this.onRightClickLogo),$("#search").on("focus",this.onSearchFocus),$("#search").on("blur",this.onSearchBlur),$("#search").on("input",this.onSeachInput),$("#btnCloseSp").on("click",this.onClosePop),$("#changeLang").on("click",this.onChangeLang),$("#btnShowMsg").on("click",this.onClickInfo),$("#btnTop").on("click",this.onClickTop)}loadQuestLine(){$.getJSON(r.getQuestLinePath(),(t=>{this.questLine=t,this.questLine.forEach(((t,e)=>{let s=this.createButton(e,t);$("#questLineList").append(s),this.buttonList.push(s)})),this.loadQuestData()}))}loadQuestData(){this.questAllData&&null!=this.questAllData[r.language]?this.initQuestList():$.getJSON(r.getQuestDataPath(r.language),(t=>{this.questAllData[r.language]=t;let e=this.questAllData[r.language],s={},i={};for(let t in e){let o=e[t].data,n=0,l=[];if(o)for(let t=0;t<o.length;t++){let e=o[t];s[e.title]=e,i[e.quest_id]=e;let c=a.deepClone(r.fakeQuest);c.x=e.x,c.y=e.y,c.name=n,n++,c.symbolSize=Math.ceil(1.3*e.symbolSize),c.symbol="image://static/"+(1==e.is_main?"main":"not_main")+".png",l.push(c)}e[t].data=l.concat(e[t].data)}this.titleToQuest[r.language]=s,this.questIdToQuest[r.language]=i,this.initQuestList()}))}createButton(e,s){const i=$("<button>",{id:"btnQuest_"+e,class:"questButton unselected",click:e=>{this.buttonList.forEach(((s,i)=>{s[0]==e.currentTarget?(localStorage.setItem(t.selectBtnIndex,i.toString()),s.removeClass("unselected").addClass("selected")):s.removeClass("selected").addClass("unselected")}));let i={title:r.language.includes("zh")?s.title_zh:s.title,data:this.questAllData[r.language][s.quest]};h.getPageData(i),this.oldQuestData=a.deepClone(i),r.isPhone||this.onClosePop(),r.isPhone&&this.toggleSidebar()}});i.data("questData",s);const o=$("<img>",{src:r.getPath(`quests_icons/QuestLineIcon/${s.quest}.png`),class:"questIcon"}),n=$("<span>",{text:r.language.includes("zh")?s.title_zh:s.title,class:"questText"});return i.append(o),i.append(n),i}initQuestList(){$("#search").val(""),$("#search").attr("placeholder",r.language==e.zh?"搜索任务":"Search Quest");let s,o=localStorage.getItem(t.selectBtnIndex);if(s=o&&this.buttonList&&this.buttonList.length?this.buttonList[parseInt(o)]:this.buttonList[0],null==s||s.removeClass("unselected").addClass("selected"),this.buttonList.length)for(let t=0;t<this.buttonList.length;t++){let s=this.buttonList[t],i=s.data("questData"),a=r.language==e.zh?i.title_zh:i.title;s.find(".questText").text(a)}let n=s.data("questData"),l=this.questAllData[r.language][n.quest];if(l){let t={title:r.language==e.zh?n.title_zh:n.title,data:l};h.getPageData(t),this.oldQuestData=a.deepClone(t),i.hideLoading(),this.checkHasQuestIdInParameters()}else console.error("任务数据异常"),i.showTips("任务数据异常")}checkHasQuestIdInParameters(){if(r.urlParameter.has("id")){var t=r.urlParameter.get("id");t in this.questIdToQuest[r.language]?c.showPopup(this.questIdToQuest[r.language][t]):(console.error("任务id有误"),i.showTips("任务id有误"))}}onClickInfo(){c.showInfoPopup()}}new class{constructor(){window.mp=new u}}})();